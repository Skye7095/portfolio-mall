<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.portfolio.mall.cart.dao.CartDAO">
	<!-- 장바구니 개별 cart 추가 -->
	<insert id="insertCart" parameterType="map">
		INSERT INTO
			`cart`
		(
			`buyerId`
			, `productId`
			, `productAmount`
			, `productSumPrice`
			, `productTotalPrice`
			, `createdAt`
			, `updatedAt`
		)
		VALUE
		(
			#{buyerId}
			, #{productId}
			, #{productAmount}
			, #{productSumPrice}
			, #{productTotalPrice}
			, now()
			, now()
		)
	</insert>

	<!-- 같은 buyer가 같은 product를 추가했는지 조회 -->
	<select id="selectSameCart" parameterType="map" resultType="int">
		SELECT 
			count(1)
		FROM
			`cart`
		WHERE
			`buyerId` = #{buyerId} AND `productId`= #{productId}
	</select>
	
	<!-- 장바구니 페이지 상품 조회 -->
	<select id="selectCartList" parameterType="int" resultType="com.portfolio.mall.cart.model.Cart">
		SELECT
			`id`
			, `buyerId`
			, `productId`
			, `productAmount`
			, `productSumPrice`
			, `productTotalPrice`
			, `createdAt`
			, `updatedAt`
		FROM
			`cart`
		WHERE `buyerId` = #{buyerId}
		ORDER BY `id` DESC
	</select>
	
	<!-- 장바구니페이지 개별 상품 삭제하기 -->
	<delete id="deleteCart" parameterType="int">
		DELETE FROM
			`cart`
		WHERE
			`id` = #{cartId}
	</delete>
	
	<!-- 장바구니 개별 상품 조회하기 -->
	<select id="selectCart" parameterType="int" resultType="com.portfolio.mall.cart.model.Cart">
		SELECT
			`id`
			, `buyerId`
			, `productId`
			, `productAmount`
			, `productSumPrice`
			, `productTotalPrice`
			, `createdAt`
			, `updatedAt`
		FROM
			`cart`
		WHERE `cartId` = #{cartId}
	</select>
	
	<!-- cartDesicion테이블로 insert -->
	<insert id="insertCartDesicion" parameterType="map">
		INSERT INTO
			`cartDesicion`
		(
			`buyerId`
			, `productId`
			, `productAmount`
			, `productSumPrice`
			, `productTotalPrice`
			, `createdAt`
			, `updatedAt`
		)
		VALUE
		(
			#{buyerId}
			, #{productId}
			, #{productAmount}
			, #{productSumPrice}
			, #{productTotalPrice}
			, now()
			, now()
		)
	</insert>
</mapper>